<div id="merchant-index-statistics">
  <h1>Top 3 Merchants with the highest profit:</h1>
  <% User.top_3_merchants_by_profit.each do |merchant| %>
    <p><%= merchant.name %> - <%= number_to_currency(merchant.earnings) %></p>
  <% end %>
  <h1>Top 3 Merchants who've sold the most items:</h1>
  <% User.top_3_merchants_by_items_sold.each do |merchant| %>
    <p><%= merchant.name %> - <%= merchant.items_sold %></p>
  <% end %>
  <h1>Top 3 Merchants who fulfill orders the fastest:</h1>
  <% User.top_3_merchants_by_fulfillment_speed.each do |merchant| %>
    <p><%= merchant.name %>, who completes orders in <%= User.find(merchant.id).fulfillment_speed %> days on average</p>
  <% end %>
  <h1>Merchants who were slowest at fulfilling orders:</h1>
  <% User.bottom_3_merchants_by_fulfillment_speed.each do |merchant| %>
    <p> <%= merchant.name %>, who completes orders in <%= User.find(merchant.id).fulfillment_speed %> days on average</p>
  <% end %>
  <h1>Top 3 States with the most orders:</h1>
  <% User.top_3_states_by_order_count.each do |relation| %>
    <p><%= relation.state %> - <%= relation.order_count %> order(s)!</p>
  <% end %>
</div>
<div class="merchant-list">
<table>
  <thead>
    <th>Name</th>
    <th>Location</th>
    <th>Registration Date</th>
  </thead>
  <tbody>
    <% @merchants.each do |merchant| %>
      <tr id="merchant-<%= merchant.id %>">
        <td><%= link_to merchant.name, admin_merchant_path(merchant), id: "merchant-name-#{merchant.id }" %></td>
        <td><%= "#{merchant.city}, #{merchant.state}"%></td>
        <td><%= merchant.created_at %></td>
        <% if current_user && current_user.admin? %>
          <% if merchant.status %>
            <td><%= button_to "Disable", admin_merchant_path(merchant), method: :patch, class: "disable" %></td>
          <% else %>
            <td><%= button_to "Enable", admin_merchant_path(merchant), method: :patch, class: "enable" %></td>
          <% end %>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
</div>
